var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,i=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&l(e,r,t[r]);if(o)for(var r of o(t))a.call(t,r)&&l(e,r,t[r]);return e},p=(e,o)=>t(e,r(o));"undefined"!=typeof require&&require;import{e as c,R as s}from"./exportToExcel.249d17da.js";import{P as u}from"./Table.401ad24c.js";import{R as f,r as d,Y as b,bb as y,P as O,F as m,J as v,a0 as g,be as P,H as j}from"./vendor.932c1d31.js";import{F as h,P as w,r as x,e as E,a as S,d as C}from"./index.a86ebf54.js";import{h as T}from"./index.f3374feb.js";import{a9 as D,bl as k}from"./index.773fe633.js";import"./index.e8b0a23a.js";import"./index.980b5b03.js";import"./index.068bc43b.js";import"./Google.9f9907d1.js";import"./index.esm.04630d09.js";var F=["proFieldProps","fieldProps"];function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){Y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var L=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=q(e,F),a=d.exports.useContext(h);return f.createElement(w,R({ref:t,mode:"edit",valueType:"date",fieldProps:M({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"date",customLightMode:!0}},n))})),V=["proFieldProps","fieldProps"];function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){W(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var G=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=z(e,V),a=d.exports.useContext(h);return f.createElement(w,A({ref:t,mode:"edit",valueType:"dateWeek",fieldProps:B({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"dateWeek",customLightMode:!0}},n))})),Q=["proFieldProps","fieldProps"];function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){$(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var U=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=J(e,Q),a=d.exports.useContext(h);return f.createElement(w,H({ref:t,mode:"edit",valueType:"dateMonth",fieldProps:N({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"dateMonth",customLightMode:!0}},n))})),Z=["fieldProps"];function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oe(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var ne=f.forwardRef((function(e,t){var r=e.fieldProps,o=oe(e,Z),n=d.exports.useContext(h);return f.createElement(w,X({ref:t,mode:"edit",valueType:"dateQuarter",fieldProps:te({getPopupContainer:n.getPopupContainer},r),filedConfig:{valueType:"dateQuarter",customLightMode:!0}},o))})),ae=["proFieldProps","fieldProps"];function le(){return(le=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function se(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var ue=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=se(e,ae),a=d.exports.useContext(h);return f.createElement(w,le({ref:t,mode:"edit",valueType:"dateYear",fieldProps:pe({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"dateYear",customLightMode:!0}},n))})),fe=L;fe.Week=G,fe.Month=U,fe.Quarter=ne,fe.Year=ue,fe.displayName="ProFormComponent";var de=fe,be=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],ye=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"];function Oe(){return(Oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pe(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var je=f.forwardRef((function(e,t){var r=e.fieldProps,o=e.children,n=e.params,a=e.proFieldProps,l=e.mode,i=e.valueEnum,p=e.request,c=e.showSearch,s=e.options,u=Pe(e,be),b=d.exports.useContext(h);return f.createElement(w,Oe({mode:"edit",valueEnum:x(i),request:p,params:n,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:ve({options:s,mode:l,showSearch:c,getPopupContainer:b.getPopupContainer},r),ref:t,proFieldProps:a},u),o)})),he=f.forwardRef((function(e,t){var r=e.fieldProps,o=e.children,n=e.params,a=e.proFieldProps,l=e.mode,i=e.valueEnum,p=e.request,c=e.options,s=Pe(e,ye),u=ve({options:c,mode:l||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label",filterOption:!1},r),b=d.exports.useContext(h);return f.createElement(w,Oe({mode:"edit",valueEnum:x(i),request:p,params:n,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:ve({getPopupContainer:b.getPopupContainer},u),ref:t,proFieldProps:a},s),o)})),we=je;we.SearchSelect=he,we.displayName="ProFormComponent";var xe=we,Ee=["fieldProps","min","proFieldProps","max"];function Se(){return(Se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(r),!0).forEach((function(t){De(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function De(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ke(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Fe=function(e,t){var r=e.fieldProps,o=e.min,n=e.proFieldProps,a=e.max,l=ke(e,Ee);return f.createElement(w,Se({mode:"edit",valueType:"digit",fieldProps:Te({min:o,max:a},r),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:n},l))},Re=f.forwardRef(Fe);const Ie=e=>{const{formRef:t}=e,r=()=>{var e,r,o,n,a,l,i;let p=0;for(let c=0;c<(null==(o=null==(r=null==(e=null==t?void 0:t.current)?void 0:e.getFieldsValue(["exRecords"]))?void 0:r.exRecords)?void 0:o.length);c++){const e=null==(l=null==(a=null==(n=null==t?void 0:t.current)?void 0:n.getFieldsValue(["exRecords"]))?void 0:a.exRecords)?void 0:l[c];p+=(null==e?void 0:e.value)?+(null==e?void 0:e.value):0}null==(i=null==t?void 0:t.current)||i.setFieldsValue({totalConsume:p})};return f.createElement(f.Fragment,null,f.createElement(de,{width:"md",name:"date",label:"日期"}),f.createElement(E,{name:"exRecords",creatorButtonProps:{creatorButtonText:"添加一笔记录"},label:"消费记录",actionRender:(e,t,o)=>o.map((e=>p(i({},e),{props:p(i({},e.props),{children:p(i({},e.props.children),{props:p(i({},e.props.children.props),{onClick:()=>{e.props.children.props.onClick(),r()}})})})})))},f.createElement(b.Group,{compact:!0},f.createElement(xe,{initialValue:"diet",options:[{value:"diet",label:"饮食"},{value:"shop",label:"购物"},{value:"transport",label:"交通"}],width:"xs",name:"type"}),f.createElement(Re,{onChange:r,name:"value",placeholder:"请输入金额",rules:[{required:!0,message:"请输入金额"}]}))),f.createElement(S,{width:"md",name:"totalConsume",label:"消费总额",disabled:!0}))},Me=async e=>T("/api/bill",{method:"GET",params:e}),Ye={diet:"饮食",shop:"购物",transport:"交通"},qe=e=>{const{data:t}=e,r=d.exports.useRef(null),o=y(),[n,a]=d.exports.useState({animationDuration:1500,title:{text:"流量趋势(PV)",textAlign:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:[]},yAxis:{type:"value"},dataZoom:[{type:"inside"}],series:[{data:[],type:"bar",itemStyle:{color:new D(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])},label:{show:!0,position:"inside"},emphasis:{itemStyle:{color:new D(0,0,0,1,[{offset:0,color:"#2378f7"},{offset:.7,color:"#2378f7"},{offset:1,color:"#83bff6"}])}}}]});return d.exports.useEffect((()=>{const e=[],r=[];null==t||t.forEach((t=>{e.push(O(t.date).format("YYYY-MM-DD")),r.push(t.totalConsume)})),n.xAxis.data=e,n.series[0].data=r,a(i({},n))}),[t]),k(r,n,!1,o),f.createElement(f.Fragment,null,f.createElement("div",{ref:r,style:{width:"100%",height:"500px"}}))},Le=()=>{const[e,t]=d.exports.useState(!1),[r,o]=d.exports.useState(),n=d.exports.useRef(),a=d.exports.useRef(),[l,b]=d.exports.useState([]),[y,h]=d.exports.useState([]),w=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"日期",dataIndex:"date",valueType:"date",sorter:!0,hideInSearch:!0},{title:"消费总额",dataIndex:"totalConsume",hideInSearch:!0},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",hideInSearch:!0},{title:"日期",dataIndex:"created_at",valueType:"dateRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"类型",dataIndex:"type",hideInTable:!0,renderFormItem:()=>{var e;return f.createElement(g,{allowClear:!0},null==(e=Object.keys(Ye))?void 0:e.map((e=>f.createElement(g.Option,{value:e,key:e},null==Ye?void 0:Ye[e]))))}},{title:"操作",valueType:"option",width:180,render:(e,t)=>[f.createElement(m,{type:"link",key:"editable",onClick:()=>{S(t)}},"编辑"),f.createElement(P,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>D(null==t?void 0:t._id),okText:"确定",okType:"danger",cancelText:"取消"},f.createElement(m,{type:"link",danger:!0,key:"delete"},"删除"))]}];d.exports.useEffect((()=>{console.log(a)}),[a]);const x=()=>{t(!0)},E=()=>{t(!1)},S=e=>{o(e),x()},D=async e=>{var t;const r=await(async e=>T(`/api/bill/${e}`,{method:"DELETE"}))(e);r&&(null==(t=null==n?void 0:n.current)||t.reload(),j.success(r.message||"删除成功"))};return f.createElement(f.Fragment,null,f.createElement(u,{scroll:{x:!0},bordered:!0,request:async(e,t,r)=>{const o=await Me(i(i(i({},e),t),r));if(o){const n=await Me(p(i(i(i({},e),t),r),{pageSize:null,current:null})),a=[];return n.data.forEach((e=>{e.exRecords.forEach((t=>{a.push({type:null==Ye?void 0:Ye[t.type],value:t.value,date:O(e.date).format("YYYY-MM-DD")})}))})),h(null==n?void 0:n.data),b(a),{data:o.data,success:!0,total:o.total}}return{data:void 0,success:!1,total:0}},columns:w,actionRef:n,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,t)=>"get"===t?p(i({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"用户列表",expandable:{expandedRowRender:e=>f.createElement(u,{columns:[{title:"类型",dataIndex:"type",key:"type",render:e=>null==Ye?void 0:Ye[e]},{title:"消费金额",dataIndex:"value",key:"value"}],headerTitle:"消费记录",search:!1,options:!1,bordered:!0,dataSource:null==e?void 0:e.exRecords,pagination:!1})},toolBarRender:()=>[f.createElement(m,{key:"out",onClick:()=>{c(l,"账单管理")}},"导出数据"),f.createElement(m,{key:"button",icon:f.createElement(C,null),type:"primary",onClick:()=>{x(),o(void 0)}},"新建")]}),f.createElement(v,{style:{marginTop:"20px"}},f.createElement(qe,{data:y})),f.createElement(s,{ref:a,onCloseDrawer:E,visibleDrawer:e,cItem:r,title:"新增用户",renderFormItemDom:()=>f.createElement(Ie,{formRef:a}),onFinish:async e=>{var t,o;if(r){const o=await(async(e,t)=>T(`/api/bill/${e}`,{method:"PATCH",data:t}))(null==r?void 0:r._id,p(i({},e),{date:new Date(null==e?void 0:e.date)}));o&&(null==(t=null==n?void 0:n.current)||t.reload(),j.success((null==o?void 0:o.message)||"更新成功"),E())}else{const t=await(async e=>T("/api/bill",{method:"POST",data:e}))(p(i({},e),{date:new Date(null==e?void 0:e.date)}));t&&(null==(o=null==n?void 0:n.current)||o.reload(),j.success(t.message||"创建成功"),E())}}}))};export{Le as default};
