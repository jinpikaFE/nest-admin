var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))n.call(t,a)&&s(e,a,t[a]);return e},i=(e,l)=>t(e,a(l));"undefined"!=typeof require&&require;import{e as d,R as m}from"./exportToExcel.249d17da.js";import{P as c}from"./Table.401ad24c.js";import{r as u,l as p,R as v,bm as f,bi as g,bn as h,Y as x,a0 as y,H as b,F as E,b6 as w,a7 as T,be as j}from"./vendor.932c1d31.js";import{q as I}from"./services.dc10608d.js";import{h as P,a as S}from"./index.f3374feb.js";import{P as C}from"./index.66f0dbb7.js";import{d as O,a as k}from"./index.a86ebf54.js";import{P as F}from"./index.5e0350e0.js";import{A as q}from"./index.980b5b03.js";import"./index.e8b0a23a.js";import"./index.068bc43b.js";import"./Google.9f9907d1.js";import"./index.99c488c8.js";import"./index.esm.04630d09.js";var z={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M477.5 536.3L135.9 270.7l-27.5-21.4 27.6 21.5V792h752V270.8L546.2 536.3a55.99 55.99 0 01-68.7 0z",fill:t}},{tag:"path",attrs:{d:"M876.3 198.8l39.3 50.5-27.6 21.5 27.7-21.5-39.3-50.5z",fill:t}},{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-94.5 72.1L512 482 190.5 232.1h643zm54.5 38.7V792H136V270.8l-27.6-21.5 27.5 21.4 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5h.1l39.3 50.5-27.7 21.5z",fill:e}}]}},name:"mail",theme:"twotone"},L=function(e,t){return u.exports.createElement(q,p(p({},e),{},{ref:t,icon:z}))};L.displayName="MailTwoTone";var R=u.exports.forwardRef(L);const $=e=>{const{avatar:t}=e,[a,l]=u.exports.useState(!1),[r,n]=u.exports.useState(""),[s,o]=u.exports.useState(""),[i,d]=u.exports.useState([]);u.exports.useEffect((()=>{var e,a;t&&(o(null==(e=null==t?void 0:t[0])?void 0:e.name),n(null==(a=null==t?void 0:t[0])?void 0:a.url),d(t))}),[t]);const m=v.createElement("div",null,v.createElement(O,null),v.createElement("div",{style:{marginTop:8}},"Upload"));return v.createElement(v.Fragment,null,v.createElement(C.Item,{label:"头像",name:"avatar"},v.createElement(f,{fileList:i,beforeUpload:()=>!1,maxCount:1,listType:"picture-card",onPreview:async e=>{o(e.name||e.url.substring(e.url.lastIndexOf("/")+1)),l(!0)},onChange:async e=>{var t,a;console.log(e),d(null==e?void 0:e.fileList);const{file:l}=e;(null==(t=null==e?void 0:e.fileList)?void 0:t.length)>0?(l.preview=await S(null==(a=null==e?void 0:e.fileList)?void 0:a[0].originFileObj),n(l.url||l.preview)):n("")}},!r&&m)),v.createElement(g,{visible:a,title:s,footer:null,onCancel:()=>l(!1)},v.createElement("img",{alt:"头像",style:{width:"100%"},src:r})))},{Option:_}=y,N=e=>{const{setCaptcha:t,cItem:a}=e,[l,{onChange:r,reset:n}]=h({transformer:e=>e.replace(/[^\d]/g,"")}),[s,o]=u.exports.useState([]);return u.exports.useEffect((()=>{(async()=>{const e=await I();e&&o(e.data)})()}),[]),v.createElement(v.Fragment,null,v.createElement(k,{width:"md",name:"userName",label:"用户名",tooltip:"最长为 16 位",placeholder:"请输入用户名",rules:[{required:!0,message:"请输入用户名!"},{validator:(e,t,a)=>{t.length>16?a("用户名过长，最长为 16 位"):a()}}]}),v.createElement(k,{width:"md",name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{type:"email",message:"请输入正确的邮箱!"},{required:!0,message:"请输入邮箱!"}]}),v.createElement(C.Item,{label:"手机号",name:"phone",rules:[{required:!0,message:"请输入手机号!"},{validator:(e,t,a)=>{/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/g.test(t)?a():a("请输入正确的手机号")}}]},v.createElement(x,{allowClear:!0,maxLength:11,className:"input-fix-md",value:l||(null==a?void 0:a.phone)||"",onChange:r})),!a&&v.createElement(v.Fragment,null,v.createElement(k.Password,{width:"md",label:"密码",name:"password",extra:"密码至少包含 数字和英文，长度6-20",validateFirst:!0,rules:[{required:!0,message:"请输入密码!"},{validator:(e,t,a)=>{/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/g.test(t)?a():a("密码至少包含 数字和英文，长度6-20")}}]}),v.createElement(k.Password,{width:"md",label:"确认密码",name:"confirmPassword",placeholder:"请再次输入密码",rules:[{required:!0,message:"请输入确认密码密码!"},({getFieldValue:e})=>({validator:(t,a)=>a&&e("password")!==a?Promise.reject(new Error("两次输入密码不一致!")):Promise.resolve()})]})),v.createElement(C.Item,{label:"角色",name:"role",rules:[{required:!0,message:"请选择角色!"}]},v.createElement(y,{placeholder:"请选择角色",className:"input-fix-md",allowClear:!0},null==s?void 0:s.map((e=>v.createElement(_,{value:null==e?void 0:e.name,key:null==e?void 0:e._id},null==e?void 0:e.name))))),v.createElement($,{avatar:null==a?void 0:a.avatar}),v.createElement(F,{fieldProps:{size:"large",prefix:v.createElement(R,null)},captchaProps:{size:"large"},label:"验证码",phoneName:"phone",name:"captcha",rules:[{required:!0,message:"请输入验证码"}],placeholder:"请输入验证码",onGetCaptcha:async e=>{const a=parseInt((1e4*Math.random()).toString());t(a.toString()),b.success(`验证码为${a}`)}}))},V=()=>{const[e,t]=u.exports.useState(!1),[a,l]=u.exports.useState(),r=u.exports.useRef(),n=u.exports.useRef(),[s,p]=u.exports.useState("1111"),[f,g]=u.exports.useState([]),[h,x]=u.exports.useState([]);u.exports.useEffect((()=>{(async()=>{const e=await I();e&&x(e.data)})()}),[]);const S=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"用户名",dataIndex:"userName",copyable:!0,ellipsis:!0,tip:"标题过长会自动收缩",formItemProps:{rules:[{required:!0,message:"此项为必填项"}]},render:(e,t)=>{var a,l;return v.createElement(w,{justify:"start",align:"middle",style:{flexFlow:"nowrap"}},(null==t?void 0:t.avatar)&&v.createElement(T,{style:{flex:"0 0 auto",marginRight:"5px"},src:null==(l=null==(a=t.avatar)?void 0:a[0])?void 0:l.url}),e)}},{title:"邮箱",dataIndex:"email"},{title:"手机号",dataIndex:"phone"},{title:"角色",dataIndex:"role",renderFormItem:()=>v.createElement(y,{allowClear:!0},null==h?void 0:h.map((e=>v.createElement(y.Option,{value:e.name,key:e._id},null==e?void 0:e.name))))},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"创建时间",dataIndex:"created_at",valueType:"dateTimeRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"操作",valueType:"option",width:180,render:(e,t,a,l)=>[v.createElement(E,{type:"link",key:"editable",onClick:()=>{F(t)}},"编辑"),v.createElement(j,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>{var e,a;return q(null==t?void 0:t._id,null==(a=null==(e=null==t?void 0:t.avatar)?void 0:e[0])?void 0:a.uid)},okText:"确定",okType:"danger",cancelText:"取消"},v.createElement(E,{type:"link",danger:!0,key:"delete"},"删除"))]}],C=()=>{t(!0)},k=()=>{t(!1)},F=e=>{l(e),C()},q=async(e,t)=>{var a;const l=await(async(e,t)=>P(`/api/users/${e}/${t}`,{method:"DELETE"}))(e,t);l&&(null==(a=null==r?void 0:r.current)||a.reload(),b.success(l.message||"删除成功"))};return v.createElement(v.Fragment,null,v.createElement(c,{scroll:{x:!0},bordered:!0,request:async(e,t,a)=>{const l=await(async e=>P("/api/users",{method:"GET",params:e}))(o(o(o({},e),t),a));return l?(g(l.data),{data:l.data,success:!0,total:l.total}):{data:void 0,success:!1,total:0}},columns:S,actionRef:r,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,t)=>"get"===t?i(o({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"用户列表",toolBarRender:()=>[v.createElement(E,{key:"out",onClick:()=>{d(f,"用户管理")}},"导出数据"),v.createElement(E,{key:"button",icon:v.createElement(O,null),type:"primary",onClick:()=>{C(),l(void 0)}},"新建")]}),v.createElement(m,{ref:n,onCloseDrawer:k,visibleDrawer:e,cItem:a,title:"新增用户",renderFormItemDom:()=>v.createElement(N,{setCaptcha:p,cItem:a}),onFinish:async e=>{var t,l,n,d;if(s===(null==e?void 0:e.captcha))if(a){const l=()=>{var t,a,l,r,n;return(null==(a=null==(t=null==e?void 0:e.avatar)?void 0:t.file)?void 0:a.preview)?null==(l=null==e?void 0:e.avatar)?void 0:l.file.preview:0===(null==(n=null==(r=null==e?void 0:e.avatar)?void 0:r.fileList)?void 0:n.length)?"":null==e?void 0:e.avatar},n=await(async(e,t)=>P(`/api/users/${e}`,{method:"PATCH",data:t}))(null==a?void 0:a._id,i(o({},e),{avatar:l()}));n&&(null==(t=null==r?void 0:r.current)||t.reload(),b.success(n.message||"更新成功"),k())}else{const t=await(async e=>P("/api/users",{method:"POST",data:e}))(i(o({},e),{avatar:null==(n=null==(l=null==e?void 0:e.avatar)?void 0:l.file)?void 0:n.preview}));t&&(null==(d=null==r?void 0:r.current)||d.reload(),b.success(t.message||"创建成功"),k())}else b.error("验证码错误")}}))};export{V as default};
