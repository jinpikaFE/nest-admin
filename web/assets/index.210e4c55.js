var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))i.call(t,a)&&o(e,a,t[a]);return e},s=(e,r)=>t(e,a(r));"undefined"!=typeof require&&require;import{e as d,R as m}from"./exportToExcel.249d17da.js";import{a as u}from"./FromTreeMenu.fe22fedf.js";import{q as c,t as p}from"./index.f3374feb.js";import{d as y,a as f}from"./index.a86ebf54.js";import{P as v}from"./index.66f0dbb7.js";import{P as b}from"./Table.401ad24c.js";import{r as h,b4 as x,bl as g,R as w,F as E,a0 as T,bq as j,be as k,H as S}from"./vendor.932c1d31.js";import{a as O,b as I,d as _,u as C,c as F}from"./services.dc10608d.js";import"./index.e8b0a23a.js";import"./index.980b5b03.js";import"./index.068bc43b.js";import"./Google.9f9907d1.js";import"./index.esm.04630d09.js";import"./index.99c488c8.js";const q=()=>{const[e,t]=h.exports.useState(!1),[a,r]=h.exports.useState(),l=h.exports.useRef(),i=h.exports.useRef(),[o,q]=h.exports.useState([]),[P,R]=h.exports.useState([]),[D,L]=h.exports.useState([]),$=x(),B=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"角色名",dataIndex:"name",copyable:!0,ellipsis:!0,tip:"标题过长会自动收缩",formItemProps:{rules:[{required:!0,message:"此项为必填项"}]}},{title:"权限",dataIndex:"authority",renderFormItem:()=>w.createElement(T,{allowClear:!0},null==P?void 0:P.map((e=>w.createElement(T.Option,{value:e._id,key:e._id},$({id:`menu.${null==e?void 0:e.name}`}))))),render:e=>w.createElement(w.Fragment,null,null==e?void 0:e.map((e=>w.createElement(j,{key:null==e?void 0:e._id,color:null==e?void 0:e.color,style:{marginBottom:"5px"}},$({id:`menu.${null==e?void 0:e.name}`})))))},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"创建时间",dataIndex:"created_at",valueType:"dateTimeRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"操作",valueType:"option",width:180,render:(e,t,a,r)=>[w.createElement(E,{type:"link",key:"editable",onClick:()=>{z(null==t?void 0:t._id)}},"编辑"),w.createElement(k,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>A(null==t?void 0:t._id,null==t?void 0:t.name),okText:"确定",okType:"danger",cancelText:"取消"},w.createElement(E,{type:"link",danger:!0,key:"delete"},"删除"))]}];h.exports.useEffect((()=>{(async()=>{const e=await c();R(null==e?void 0:e.data)})()}),[]),h.exports.useEffect((()=>{if(e){(async()=>{if(P){const e=p(P,"_id","lastMenu",(e=>(e.title=$({id:`menu.${e.name}`}),e.value=e._id,(null==e?void 0:e.isLink)?(e.disabled=!0,e):e)));q(e)}})()}}),[e,a]);const H=()=>{t(!0)},N=()=>{t(!1)},z=async e=>{const t=await I(e);r(null==t?void 0:t.data),H()},A=async(e,t)=>{var a;const r=await _(e,t);if(r){await u({name:t})&&(null==(a=null==l?void 0:l.current)||a.reload(),S.success(r.message||"删除成功"))}},J={treeData:o,treeDefaultExpandAll:!0,treeCheckable:!0,treeCheckStrictly:!0,showCheckedStrategy:g.SHOW_ALL,placeholder:"请选择",allowClear:!0,className:"input-fix-md",dropdownStyle:{maxHeight:400,overflow:"auto"}};return w.createElement(w.Fragment,null,w.createElement(b,{scroll:{x:!0},bordered:!0,request:async(e,t,a)=>{var r;const l=await c(),i=await O(n(n(n({},e),t),a)),o=null==(r=i.data)?void 0:r.map((e=>{var t;return e.authority=[],null==(t=null==l?void 0:l.data)||t.forEach((t=>{t.authority.includes(e.name)&&e.authority.push(t)})),e})),s=JSON.parse(JSON.stringify(o));if(i){const e=s.map((e=>{var t;const a=[];null==(t=null==e?void 0:e.authority)||t.map((e=>{a.push($({id:`menu.${e.name}`}))})),e.authority=a;const{name:r,authority:l,registerTime:i}=e;return{name:r,authority:l,registerTime:new Date(i).toLocaleString()}}));return L(e),{data:o,success:!0,total:i.total}}return{data:void 0,success:!1,total:0}},columns:B,actionRef:l,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,t)=>"get"===t?s(n({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"角色列表",toolBarRender:()=>[w.createElement(E,{key:"out",onClick:()=>{d(D,"角色管理")}},"导出数据"),w.createElement(E,{key:"button",icon:w.createElement(y,null),type:"primary",onClick:()=>{H(),r(void 0)}},"新建")]}),w.createElement(m,{ref:i,onCloseDrawer:N,visibleDrawer:e,cItem:a,title:"新增角色",renderFormItemDom:()=>w.createElement(w.Fragment,null,w.createElement(f,{width:"md",name:"name",label:"角色名",tooltip:"最长为 16 位",placeholder:"请输入角色名",rules:[{required:!0,message:"请输入角色名!"},{validator:(e,t,a)=>{t.length>16?a("角色名过长，最长为 16 位"):a()}}]}),w.createElement(v.Item,{label:"权限",name:"authority",rules:[{required:!0,message:"请选择权限!"}]},w.createElement(g,n({},J)))),onFinish:async e=>{var t,r,i;const o=null==(t=null==e?void 0:e.authority)?void 0:t.map((e=>e.value));if(a){const t=await C(null==a?void 0:a._id,s(n({},e),{authority:o}));if(t){await u(s(n({},e),{authority:o}))&&(null==(r=null==l?void 0:l.current)||r.reload(),S.success(t.message||"更新成功"),N())}}else{const t=await F(s(n({},e),{authority:o}));if(t){await u(s(n({},e),{authority:o}))&&(null==(i=null==l?void 0:l.current)||i.reload(),S.success(t.message||"创建成功"),N())}}}}))};export{q as default};
