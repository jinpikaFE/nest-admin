var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,i=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&l(e,r,t[r]);if(o)for(var r of o(t))a.call(t,r)&&l(e,r,t[r]);return e},p=(e,o)=>t(e,r(o));"undefined"!=typeof require&&require;import{e as c,R as s}from"./exportToExcel.249d17da.js";import{P as u}from"./Table.401ad24c.js";import{R as f,r as d,Y as b,bb as y,P as O,F as m,J as g,be as v,H as P}from"./vendor.932c1d31.js";import{F as j,P as h,r as w,e as x,a as E,d as S}from"./index.a86ebf54.js";import{h as C}from"./index.e1fb5c85.js";import{a9 as D,bl as T}from"./index.773fe633.js";import"./index.e8b0a23a.js";import"./index.980b5b03.js";import"./index.068bc43b.js";import"./Google.9f9907d1.js";import"./index.esm.04630d09.js";var F=["proFieldProps","fieldProps"];function k(){return(k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){M(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var q=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=Y(e,F),a=d.exports.useContext(j);return f.createElement(h,k({ref:t,mode:"edit",valueType:"date",fieldProps:I({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"date",customLightMode:!0}},n))})),L=["proFieldProps","fieldProps"];function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function W(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var z=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=W(e,L),a=d.exports.useContext(j);return f.createElement(h,V({ref:t,mode:"edit",valueType:"dateWeek",fieldProps:_({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"dateWeek",customLightMode:!0}},n))})),G=["proFieldProps","fieldProps"];function Q(){return(Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){N(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var J=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=$(e,G),a=d.exports.useContext(j);return f.createElement(h,Q({ref:t,mode:"edit",valueType:"dateMonth",fieldProps:K({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"dateMonth",customLightMode:!0}},n))})),U=["fieldProps"];function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var oe=f.forwardRef((function(e,t){var r=e.fieldProps,o=re(e,U),n=d.exports.useContext(j);return f.createElement(h,Z({ref:t,mode:"edit",valueType:"dateQuarter",fieldProps:ee({getPopupContainer:n.getPopupContainer},r),filedConfig:{valueType:"dateQuarter",customLightMode:!0}},o))})),ne=["proFieldProps","fieldProps"];function ae(){return(ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ce(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var se=f.forwardRef((function(e,t){var r=e.proFieldProps,o=e.fieldProps,n=ce(e,ne),a=d.exports.useContext(j);return f.createElement(h,ae({ref:t,mode:"edit",valueType:"dateYear",fieldProps:ie({getPopupContainer:a.getPopupContainer},o),proFieldProps:r,filedConfig:{valueType:"dateYear",customLightMode:!0}},n))})),ue=q;ue.Week=z,ue.Month=J,ue.Quarter=oe,ue.Year=se,ue.displayName="ProFormComponent";var fe=ue,de=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],be=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"];function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Pe=f.forwardRef((function(e,t){var r=e.fieldProps,o=e.children,n=e.params,a=e.proFieldProps,l=e.mode,i=e.valueEnum,p=e.request,c=e.showSearch,s=e.options,u=ve(e,de),b=d.exports.useContext(j);return f.createElement(h,ye({mode:"edit",valueEnum:w(i),request:p,params:n,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:me({options:s,mode:l,showSearch:c,getPopupContainer:b.getPopupContainer},r),ref:t,proFieldProps:a},u),o)})),je=f.forwardRef((function(e,t){var r=e.fieldProps,o=e.children,n=e.params,a=e.proFieldProps,l=e.mode,i=e.valueEnum,p=e.request,c=e.options,s=ve(e,be),u=me({options:c,mode:l||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label",filterOption:!1},r),b=d.exports.useContext(j);return f.createElement(h,ye({mode:"edit",valueEnum:w(i),request:p,params:n,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:me({getPopupContainer:b.getPopupContainer},u),ref:t,proFieldProps:a},s),o)})),he=Pe;he.SearchSelect=je,he.displayName="ProFormComponent";var we=he,xe=["fieldProps","min","proFieldProps","max"];function Ee(){return(Ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(r),!0).forEach((function(t){De(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function De(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Te(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Fe=function(e,t){var r=e.fieldProps,o=e.min,n=e.proFieldProps,a=e.max,l=Te(e,xe);return f.createElement(h,Ee({mode:"edit",valueType:"digit",fieldProps:Ce({min:o,max:a},r),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:n},l))},ke=f.forwardRef(Fe);const Re=e=>{const{formRef:t}=e,r=()=>{var e,r,o,n,a,l,i;let p=0;for(let c=0;c<(null==(o=null==(r=null==(e=null==t?void 0:t.current)?void 0:e.getFieldsValue(["exRecords"]))?void 0:r.exRecords)?void 0:o.length);c++){const e=null==(l=null==(a=null==(n=null==t?void 0:t.current)?void 0:n.getFieldsValue(["exRecords"]))?void 0:a.exRecords)?void 0:l[c];p+=(null==e?void 0:e.value)?+(null==e?void 0:e.value):0}null==(i=null==t?void 0:t.current)||i.setFieldsValue({totalConsume:p})};return f.createElement(f.Fragment,null,f.createElement(fe,{width:"md",name:"date",label:"日期"}),f.createElement(x,{name:"exRecords",creatorButtonProps:{creatorButtonText:"添加一笔记录"},label:"消费记录",actionRender:(e,t,o)=>o.map((e=>p(i({},e),{props:p(i({},e.props),{children:p(i({},e.props.children),{props:p(i({},e.props.children.props),{onClick:()=>{e.props.children.props.onClick(),r()}})})})})))},f.createElement(b.Group,{compact:!0},f.createElement(we,{initialValue:"diet",options:[{value:"diet",label:"饮食"},{value:"shop",label:"购物"}],width:"xs",name:"type"}),f.createElement(ke,{onChange:r,name:"value",placeholder:"请输入金额",rules:[{required:!0,message:"请输入金额"}]}))),f.createElement(E,{width:"md",name:"totalConsume",label:"消费总额",disabled:!0}))},Ie=async e=>C("/api/bill",{method:"GET",params:e}),Me={diet:"饮食",shop:"购物"},Ye=e=>{const{data:t}=e,r=d.exports.useRef(null),o=y(),[n,a]=d.exports.useState({animationDuration:1500,title:{text:"流量趋势(PV)",textAlign:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:[]},yAxis:{type:"value"},dataZoom:[{type:"inside"}],series:[{data:[],type:"bar",itemStyle:{color:new D(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])},label:{show:!0,position:"inside"},emphasis:{itemStyle:{color:new D(0,0,0,1,[{offset:0,color:"#2378f7"},{offset:.7,color:"#2378f7"},{offset:1,color:"#83bff6"}])}}}]});return d.exports.useEffect((()=>{const e=[],r=[];null==t||t.forEach((t=>{e.push(O(t.date).format("YYYY-MM-DD")),r.push(t.totalConsume)})),n.xAxis.data=e,n.series[0].data=r,a(i({},n))}),[t]),T(r,n,!1,o),f.createElement(f.Fragment,null,f.createElement("div",{ref:r,style:{width:"100%",height:"500px"}}))},qe=()=>{const[e,t]=d.exports.useState(!1),[r,o]=d.exports.useState(),n=d.exports.useRef(),a=d.exports.useRef(),[l,b]=d.exports.useState([]),[y,j]=d.exports.useState([]),h=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"日期",dataIndex:"date",valueType:"date",sorter:!0,hideInSearch:!0},{title:"消费总额",dataIndex:"totalConsume",hideInSearch:!0},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",hideInSearch:!0},{title:"日期",dataIndex:"created_at",valueType:"dateRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"操作",valueType:"option",width:180,render:(e,t)=>[f.createElement(m,{type:"link",key:"editable",onClick:()=>{E(t)}},"编辑"),f.createElement(v,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>D(null==t?void 0:t._id),okText:"确定",okType:"danger",cancelText:"取消"},f.createElement(m,{type:"link",danger:!0,key:"delete"},"删除"))]}];d.exports.useEffect((()=>{console.log(a)}),[a]);const w=()=>{t(!0)},x=()=>{t(!1)},E=e=>{o(e),w()},D=async e=>{var t;const r=await(async e=>C(`/api/bill/${e}`,{method:"DELETE"}))(e);r&&(null==(t=null==n?void 0:n.current)||t.reload(),P.success(r.message||"删除成功"))};return f.createElement(f.Fragment,null,f.createElement(u,{scroll:{x:!0},bordered:!0,request:async(e,t,r)=>{const o=await Ie(i(i(i({},e),t),r));if(o){const n=await Ie(p(i(i(i({},e),t),r),{pageSize:null,current:null})),a=[];return n.data.forEach((e=>{e.exRecords.forEach((t=>{a.push({type:null==Me?void 0:Me[t.type],value:t.value,date:O(e.date).format("YYYY-MM-DD")})}))})),j(null==n?void 0:n.data),b(a),{data:o.data,success:!0,total:o.total}}return{data:void 0,success:!1,total:0}},columns:h,actionRef:n,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,t)=>"get"===t?p(i({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"用户列表",expandable:{expandedRowRender:e=>f.createElement(u,{columns:[{title:"类型",dataIndex:"type",key:"type",render:e=>null==Me?void 0:Me[e]},{title:"消费金额",dataIndex:"value",key:"value"}],headerTitle:"消费记录",search:!1,options:!1,bordered:!0,dataSource:null==e?void 0:e.exRecords,pagination:!1})},toolBarRender:()=>[f.createElement(m,{key:"out",onClick:()=>{c(l,"账单管理")}},"导出数据"),f.createElement(m,{key:"button",icon:f.createElement(S,null),type:"primary",onClick:()=>{w(),o(void 0)}},"新建")]}),f.createElement(g,{style:{marginTop:"20px"}},f.createElement(Ye,{data:y})),f.createElement(s,{ref:a,onCloseDrawer:x,visibleDrawer:e,cItem:r,title:"新增用户",renderFormItemDom:()=>f.createElement(Re,{formRef:a}),onFinish:async e=>{var t,o;if(r){const o=await(async(e,t)=>C(`/api/bill/${e}`,{method:"PATCH",data:t}))(null==r?void 0:r._id,p(i({},e),{date:new Date(null==e?void 0:e.date)}));o&&(null==(t=null==n?void 0:n.current)||t.reload(),P.success((null==o?void 0:o.message)||"更新成功"),x())}else{const t=await(async e=>C("/api/bill",{method:"POST",data:e}))(p(i({},e),{date:new Date(null==e?void 0:e.date)}));t&&(null==(o=null==n?void 0:n.current)||o.reload(),P.success(t.message||"创建成功"),x())}}}))};export{qe as default};
