var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&o(e,a,t[a]);return e},s=(e,r)=>t(e,a(r));"undefined"!=typeof require&&require;import{e as d,R as m}from"./exportToExcel.afc37706.js";import{a as c}from"./FromTreeMenu.af3eea12.js";import{q as u,t as p}from"./index.5d681503.js";import{d as y,a as f}from"./index.56850026.js";import{P as v}from"./index.a53400eb.js";import{P as h}from"./Table.a3ea218d.js";import{r as x,b4 as g,bk as b,R as w,G as E,a0 as T,bp as j,bd as k,J as S}from"./vendor.e4568de2.js";import{a as O,b as I,d as _,u as C,c as F}from"./services.e86895f2.js";import"./index.d9b18d8d.js";import"./index.7f87c46c.js";import"./index.cc17fd5c.js";import"./Google.c545e6d4.js";import"./index.esm.c5159ea7.js";import"./index.d85ed8ca.js";const P=()=>{const[e,t]=x.exports.useState(!1),[a,r]=x.exports.useState(),i=x.exports.useRef(),l=x.exports.useRef(),[o,P]=x.exports.useState([]),[R,q]=x.exports.useState([]),[D,L]=x.exports.useState([]),$=g(),B=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"角色名",dataIndex:"name",copyable:!0,ellipsis:!0,tip:"标题过长会自动收缩",formItemProps:{rules:[{required:!0,message:"此项为必填项"}]}},{title:"权限",dataIndex:"authority",renderFormItem:()=>w.createElement(T,{allowClear:!0},null==R?void 0:R.map((e=>w.createElement(T.Option,{value:e._id,key:e._id},$({id:`menu.${null==e?void 0:e.name}`}))))),render:e=>w.createElement(w.Fragment,null,null==e?void 0:e.map((e=>w.createElement(j,{key:null==e?void 0:e._id,color:null==e?void 0:e.color,style:{marginBottom:"5px"}},$({id:`menu.${null==e?void 0:e.name}`})))))},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"创建时间",dataIndex:"created_at",valueType:"dateTimeRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"操作",valueType:"option",width:180,render:(e,t,a,r)=>[w.createElement(E,{type:"link",key:"editable",onClick:()=>{z(null==t?void 0:t._id)}},"编辑"),w.createElement(k,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>A(null==t?void 0:t._id,null==t?void 0:t.name),okText:"确定",okType:"danger",cancelText:"取消"},w.createElement(E,{type:"link",danger:!0,key:"delete"},"删除"))]}];x.exports.useEffect((()=>{(async()=>{const e=await u();q(null==e?void 0:e.data)})()}),[]),x.exports.useEffect((()=>{if(e){(async()=>{if(R){const e=p(R,"_id","lastMenu",(e=>(e.title=$({id:`menu.${e.name}`}),e.value=e._id,(null==e?void 0:e.isLink)?(e.disabled=!0,e):e)));P(e)}})()}}),[e,a]);const J=()=>{t(!0)},N=()=>{t(!1)},z=async e=>{const t=await I(e);r(null==t?void 0:t.data),J()},A=async(e,t)=>{var a;const r=await _(e,t);if(r){await c({name:t})&&(null==(a=null==i?void 0:i.current)||a.reload(),S.success(r.message||"删除成功"))}},G={treeData:o,treeDefaultExpandAll:!0,treeCheckable:!0,treeCheckStrictly:!0,showCheckedStrategy:b.SHOW_ALL,placeholder:"请选择",allowClear:!0,className:"input-fix-md",dropdownStyle:{maxHeight:400,overflow:"auto"}};return w.createElement(w.Fragment,null,w.createElement(h,{scroll:{x:!0},bordered:!0,request:async(e,t,a)=>{var r;const i=await u(),l=await O(n(n(n({},e),t),a)),o=null==(r=l.data)?void 0:r.map((e=>{var t;return e.authority=[],null==(t=null==i?void 0:i.data)||t.forEach((t=>{t.authority.includes(e.name)&&e.authority.push(t)})),e})),s=JSON.parse(JSON.stringify(o));if(l){const e=s.map((e=>{var t;const a=[];null==(t=null==e?void 0:e.authority)||t.map((e=>{a.push($({id:`menu.${e.name}`}))})),e.authority=a;const{name:r,authority:i,registerTime:l}=e;return{name:r,authority:i,registerTime:new Date(l).toLocaleString()}}));return L(e),{data:o,success:!0,total:l.total}}return{data:void 0,success:!1,total:0}},columns:B,actionRef:i,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,t)=>"get"===t?s(n({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"角色列表",toolBarRender:()=>[w.createElement(E,{key:"out",onClick:()=>{d(D,"角色管理")}},"导出数据"),w.createElement(E,{key:"button",icon:w.createElement(y,null),type:"primary",onClick:()=>{J(),r(void 0)}},"新建")]}),w.createElement(m,{ref:l,onCloseDrawer:N,visibleDrawer:e,cItem:a,title:"新增角色",renderFormItemDom:()=>w.createElement(w.Fragment,null,w.createElement(f,{width:"md",name:"name",label:"角色名",tooltip:"最长为 16 位",placeholder:"请输入角色名",rules:[{required:!0,message:"请输入角色名!"},{validator:(e,t,a)=>{t.length>16?a("角色名过长，最长为 16 位"):a()}}]}),w.createElement(v.Item,{label:"权限",name:"authority",rules:[{required:!0,message:"请选择权限!"}]},w.createElement(b,n({},G)))),onFinish:async e=>{var t,r,l;const o=null==(t=null==e?void 0:e.authority)?void 0:t.map((e=>e.value));if(a){const t=await C(null==a?void 0:a._id,s(n({},e),{authority:o}));if(t){await c(s(n({},e),{authority:o}))&&(null==(r=null==i?void 0:i.current)||r.reload(),S.success(t.message||"更新成功"),N())}}else{const t=await F(s(n({},e),{authority:o}));if(t){await c(s(n({},e),{authority:o}))&&(null==(l=null==i?void 0:i.current)||l.reload(),S.success(t.message||"创建成功"),N())}}}}))};export{P as default};
