var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&s(e,t,a[t]);return e},o=(e,l)=>a(e,t(l));"undefined"!=typeof require&&require;import{q as d,e as m,R as c}from"./services.0b964631.js";import{P as u}from"./Table.0ff8bf7b.js";import{r as p,h as v,R as f,bg as g,bc as h,bh as y,Q as b,W as x,C as E,z as w,b1 as T,a2 as I,b8 as j}from"./vendor.d60c66d5.js";import{h as P,a as S}from"./index.a7a14da7.js";import{a as C,b as O}from"./index.8659b4e0.js";import{P as k}from"./index.3728936b.js";import{P as q}from"./index.1b0c0f3f.js";import{A as z}from"./index.54cf575a.js";import"./index.d98492eb.js";import"./Google.4865ce65.js";import"./index.esm.e76df7fa.js";var F={icon:function(e,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M477.5 536.3L135.9 270.7l-27.5-21.4 27.6 21.5V792h752V270.8L546.2 536.3a55.99 55.99 0 01-68.7 0z",fill:a}},{tag:"path",attrs:{d:"M876.3 198.8l39.3 50.5-27.6 21.5 27.7-21.5-39.3-50.5z",fill:a}},{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-94.5 72.1L512 482 190.5 232.1h643zm54.5 38.7V792H136V270.8l-27.6-21.5 27.5 21.4 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5h.1l39.3 50.5-27.7 21.5z",fill:e}}]}},name:"mail",theme:"twotone"},L=function(e,a){return p.exports.createElement(z,v(v({},e),{},{ref:a,icon:F}))};L.displayName="MailTwoTone";var R=p.exports.forwardRef(L);const $=e=>{const{avatar:a}=e,[t,l]=p.exports.useState(!1),[r,n]=p.exports.useState(""),[s,i]=p.exports.useState(""),[o,d]=p.exports.useState([]);p.exports.useEffect((()=>{var e,t;a&&(i(null==(e=null==a?void 0:a[0])?void 0:e.name),n(null==(t=null==a?void 0:a[0])?void 0:t.url),d(a))}),[a]);const m=f.createElement("div",null,f.createElement(k,null),f.createElement("div",{style:{marginTop:8}},"Upload"));return f.createElement(f.Fragment,null,f.createElement(C.Item,{label:"头像",name:"avatar"},f.createElement(g,{fileList:o,beforeUpload:()=>!1,maxCount:1,listType:"picture-card",onPreview:async e=>{i(e.name||e.url.substring(e.url.lastIndexOf("/")+1)),l(!0)},onChange:async e=>{var a,t;console.log(e),d(null==e?void 0:e.fileList);const{file:l}=e;(null==(a=null==e?void 0:e.fileList)?void 0:a.length)>0?(l.preview=await S(null==(t=null==e?void 0:e.fileList)?void 0:t[0].originFileObj),n(l.url||l.preview)):n("")}},!r&&m)),f.createElement(h,{visible:t,title:s,footer:null,onCancel:()=>l(!1)},f.createElement("img",{alt:"头像",style:{width:"100%"},src:r})))},{Option:_}=x,N=e=>{const{setCaptcha:a,cItem:t}=e,[l,{onChange:r,reset:n}]=y({transformer:e=>e.replace(/[^\d]/g,"")}),[s,i]=p.exports.useState([]);return p.exports.useEffect((()=>{(async()=>{const e=await d();e&&i(e.data)})()}),[]),f.createElement(f.Fragment,null,f.createElement(O,{width:"md",name:"userName",label:"用户名",tooltip:"最长为 16 位",placeholder:"请输入用户名",rules:[{required:!0,message:"请输入用户名!"},{validator:(e,a,t)=>{a.length>16?t("用户名过长，最长为 16 位"):t()}}]}),f.createElement(O,{width:"md",name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{type:"email",message:"请输入正确的邮箱!"},{required:!0,message:"请输入邮箱!"}]}),f.createElement(C.Item,{label:"手机号",name:"phone",rules:[{required:!0,message:"请输入手机号!"},{validator:(e,a,t)=>{/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/g.test(a)?t():t("请输入正确的手机号")}}]},f.createElement(b,{allowClear:!0,maxLength:11,className:"input-fix-md",value:l||(null==t?void 0:t.phone)||"",onChange:r})),!t&&f.createElement(f.Fragment,null,f.createElement(O.Password,{width:"md",label:"密码",name:"password",extra:"密码至少包含 数字和英文，长度6-20",validateFirst:!0,rules:[{required:!0,message:"请输入密码!"},{validator:(e,a,t)=>{/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/g.test(a)?t():t("密码至少包含 数字和英文，长度6-20")}}]}),f.createElement(O.Password,{width:"md",label:"确认密码",name:"confirmPassword",placeholder:"请再次输入密码",rules:[{required:!0,message:"请输入确认密码密码!"},({getFieldValue:e})=>({validator:(a,t)=>t&&e("password")!==t?Promise.reject(new Error("两次输入密码不一致!")):Promise.resolve()})]})),f.createElement(C.Item,{label:"角色",name:"role",rules:[{required:!0,message:"请选择角色!"}]},f.createElement(x,{placeholder:"请选择角色",className:"input-fix-md",allowClear:!0},null==s?void 0:s.map((e=>f.createElement(_,{value:null==e?void 0:e.name,key:null==e?void 0:e._id},null==e?void 0:e.name))))),f.createElement($,{avatar:null==t?void 0:t.avatar}),f.createElement(q,{fieldProps:{size:"large",prefix:f.createElement(R,null)},captchaProps:{size:"large"},label:"验证码",phoneName:"phone",name:"captcha",rules:[{required:!0,message:"请输入验证码"}],placeholder:"请输入验证码",onGetCaptcha:async e=>{const t=parseInt((1e4*Math.random()).toString());a(t.toString()),E.success(`验证码为${t}`)}}))},V=()=>{const[e,a]=p.exports.useState(!1),[t,l]=p.exports.useState(),r=p.exports.useRef(),[n,s]=p.exports.useState("1111"),[v,g]=p.exports.useState([]),[h,y]=p.exports.useState([]);p.exports.useEffect((()=>{(async()=>{const e=await d();e&&y(e.data)})()}),[]);const b=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"用户名",dataIndex:"userName",copyable:!0,ellipsis:!0,tip:"标题过长会自动收缩",formItemProps:{rules:[{required:!0,message:"此项为必填项"}]},render:(e,a)=>{var t,l;return f.createElement(T,{justify:"start",align:"middle",style:{flexFlow:"nowrap"}},(null==a?void 0:a.avatar)&&f.createElement(I,{style:{flex:"0 0 auto",marginRight:"5px"},src:null==(l=null==(t=a.avatar)?void 0:t[0])?void 0:l.url}),e)}},{title:"邮箱",dataIndex:"email"},{title:"手机号",dataIndex:"phone"},{title:"角色",dataIndex:"role",renderFormItem:()=>f.createElement(x,{allowClear:!0},null==h?void 0:h.map((e=>f.createElement(x.Option,{value:e.name,key:e._id},null==e?void 0:e.name))))},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"创建时间",dataIndex:"created_at",valueType:"dateTimeRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"操作",valueType:"option",width:180,render:(e,a,t,l)=>[f.createElement(w,{type:"link",key:"editable",onClick:()=>{O(a)}},"编辑"),f.createElement(j,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>{var e,t;return q(null==a?void 0:a._id,null==(t=null==(e=null==a?void 0:a.avatar)?void 0:e[0])?void 0:t.uid)},okText:"确定",okType:"danger",cancelText:"取消"},f.createElement(w,{type:"link",danger:!0,key:"delete"},"删除"))]}],S=()=>{a(!0)},C=()=>{a(!1)},O=e=>{l(e),S()},q=async(e,a)=>{var t;const l=await(async(e,a)=>P(`/api/users/${e}/${a}`,{method:"DELETE"}))(e,a);l&&(null==(t=null==r?void 0:r.current)||t.reload(),E.success(l.message||"删除成功"))};return f.createElement(f.Fragment,null,f.createElement(u,{scroll:{x:!0},bordered:!0,request:async(e,a,t)=>{const l=await(async e=>P("/api/users",{method:"GET",params:e}))(i(i(i({},e),a),t));return l?{data:l.data,success:!0,total:l.total}:{data:void 0,success:!1,total:0}},columns:b,actionRef:r,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,a)=>"get"===a?o(i({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"用户列表",toolBarRender:()=>[f.createElement(w,{key:"out",onClick:()=>{m(v,"角色管理")}},"导出数据"),f.createElement(w,{key:"button",icon:f.createElement(k,null),type:"primary",onClick:()=>{S(),l(void 0)}},"新建")]}),f.createElement(c,{onCloseDrawer:C,visibleDrawer:e,cItem:t,title:"新增用户",renderFormItemDom:()=>f.createElement(N,{setCaptcha:s,cItem:t}),onFinish:async e=>{var a,l,s,d;if(n===(null==e?void 0:e.captcha))if(t){const l=()=>{var a,t,l,r,n;return(null==(t=null==(a=null==e?void 0:e.avatar)?void 0:a.file)?void 0:t.preview)?null==(l=null==e?void 0:e.avatar)?void 0:l.file.preview:0===(null==(n=null==(r=null==e?void 0:e.avatar)?void 0:r.fileList)?void 0:n.length)?"":null==e?void 0:e.avatar},n=await(async(e,a)=>P(`/api/users/${e}`,{method:"PATCH",data:a}))(null==t?void 0:t._id,o(i({},e),{avatar:l()}));n&&(null==(a=null==r?void 0:r.current)||a.reload(),E.success(n.message||"更新成功"),C())}else{const a=await(async e=>P("/api/users",{method:"POST",data:e}))(o(i({},e),{avatar:null==(s=null==(l=null==e?void 0:e.avatar)?void 0:l.file)?void 0:s.preview}));a&&(null==(d=null==r?void 0:r.current)||d.reload(),E.success(a.message||"创建成功"),C())}else E.error("验证码错误")}}))};export{V as default};
