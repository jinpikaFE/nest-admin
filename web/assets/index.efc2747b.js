var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))n.call(a,t)&&s(e,t,a[t]);return e},o=(e,l)=>a(e,t(l));"undefined"!=typeof require&&require;import{q as d,e as c,R as m}from"./services.b795523d.js";import{a as u,P as p}from"./Table.48a8ea9c.js";import{r as v,h as f,R as g,bh as h,be as y,bi as x,Q as E,W as b,C as w,z as T,b1 as I,aA as j,b9 as S}from"./vendor.b3ee8ec2.js";import{h as C,a as P}from"./index.9a69141c.js";import{a as O,b as k}from"./index.78fc2206.js";import{P as q}from"./index.3ac26bfd.js";import{A as z}from"./index.d0d4d799.js";import"./index.944e7fb0.js";/* empty css              */import"./index.0e18a496.js";import"./index.da884ff9.js";var F={icon:function(e,a){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M477.5 536.3L135.9 270.7l-27.5-21.4 27.6 21.5V792h752V270.8L546.2 536.3a55.99 55.99 0 01-68.7 0z",fill:a}},{tag:"path",attrs:{d:"M876.3 198.8l39.3 50.5-27.6 21.5 27.7-21.5-39.3-50.5z",fill:a}},{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-94.5 72.1L512 482 190.5 232.1h643zm54.5 38.7V792H136V270.8l-27.6-21.5 27.5 21.4 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5h.1l39.3 50.5-27.7 21.5z",fill:e}}]}},name:"mail",theme:"twotone"},L=function(e,a){return v.exports.createElement(z,f(f({},e),{},{ref:a,icon:F}))};L.displayName="MailTwoTone";var R=v.exports.forwardRef(L);const $=e=>{const{avatar:a}=e,[t,l]=v.exports.useState(!1),[r,n]=v.exports.useState(""),[s,i]=v.exports.useState(""),[o,d]=v.exports.useState([]);v.exports.useEffect((()=>{var e,t;a&&(i(null==(e=null==a?void 0:a[0])?void 0:e.name),n(null==(t=null==a?void 0:a[0])?void 0:t.url),d(a))}),[a]);const c=g.createElement("div",null,g.createElement(u,null),g.createElement("div",{style:{marginTop:8}},"Upload"));return g.createElement(g.Fragment,null,g.createElement(O.Item,{label:"头像",name:"avatar"},g.createElement(h,{fileList:o,beforeUpload:()=>!1,maxCount:1,listType:"picture-card",onPreview:async e=>{i(e.name||e.url.substring(e.url.lastIndexOf("/")+1)),l(!0)},onChange:async e=>{var a,t;console.log(e),d(null==e?void 0:e.fileList);const{file:l}=e;(null==(a=null==e?void 0:e.fileList)?void 0:a.length)>0?(l.preview=await P(null==(t=null==e?void 0:e.fileList)?void 0:t[0].originFileObj),n(l.url||l.preview)):n("")}},!r&&c)),g.createElement(y,{visible:t,title:s,footer:null,onCancel:()=>l(!1)},g.createElement("img",{alt:"头像",style:{width:"100%"},src:r})))},{Option:_}=b,N=e=>{const{setCaptcha:a,cItem:t}=e,[l,{onChange:r,reset:n}]=x({transformer:e=>e.replace(/[^\d]/g,"")}),[s,i]=v.exports.useState([]);return v.exports.useEffect((()=>{(async()=>{const e=await d();e&&i(e.data)})()}),[]),g.createElement(g.Fragment,null,g.createElement(k,{width:"md",name:"userName",label:"用户名",tooltip:"最长为 16 位",placeholder:"请输入用户名",rules:[{required:!0,message:"请输入用户名!"},{validator:(e,a,t)=>{a.length>16?t("用户名过长，最长为 16 位"):t()}}]}),g.createElement(k,{width:"md",name:"email",label:"邮箱",placeholder:"请输入邮箱",rules:[{type:"email",message:"请输入正确的邮箱!"},{required:!0,message:"请输入邮箱!"}]}),g.createElement(O.Item,{label:"手机号",name:"phone",rules:[{required:!0,message:"请输入手机号!"},{validator:(e,a,t)=>{/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/g.test(a)?t():t("请输入正确的手机号")}}]},g.createElement(E,{allowClear:!0,maxLength:11,className:"input-fix-md",value:l||(null==t?void 0:t.phone)||"",onChange:r})),!t&&g.createElement(g.Fragment,null,g.createElement(k.Password,{width:"md",label:"密码",name:"password",extra:"密码至少包含 数字和英文，长度6-20",validateFirst:!0,rules:[{required:!0,message:"请输入密码!"},{validator:(e,a,t)=>{/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/g.test(a)?t():t("密码至少包含 数字和英文，长度6-20")}}]}),g.createElement(k.Password,{width:"md",label:"确认密码",name:"confirmPassword",placeholder:"请再次输入密码",rules:[{required:!0,message:"请输入确认密码密码!"},({getFieldValue:e})=>({validator:(a,t)=>t&&e("password")!==t?Promise.reject(new Error("两次输入密码不一致!")):Promise.resolve()})]})),g.createElement(O.Item,{label:"角色",name:"role",rules:[{required:!0,message:"请选择角色!"}]},g.createElement(b,{placeholder:"请选择角色",className:"input-fix-md",allowClear:!0},null==s?void 0:s.map((e=>g.createElement(_,{value:null==e?void 0:e.name,key:null==e?void 0:e._id},null==e?void 0:e.name))))),g.createElement($,{avatar:null==t?void 0:t.avatar}),g.createElement(q,{fieldProps:{size:"large",prefix:g.createElement(R,null)},captchaProps:{size:"large"},label:"验证码",phoneName:"phone",name:"captcha",rules:[{required:!0,message:"请输入验证码"}],placeholder:"请输入验证码",onGetCaptcha:async e=>{const t=parseInt((1e4*Math.random()).toString());a(t.toString()),w.success(`验证码为${t}`)}}))},V=()=>{const[e,a]=v.exports.useState(!1),[t,l]=v.exports.useState(),r=v.exports.useRef(),[n,s]=v.exports.useState("1111"),[f,h]=v.exports.useState([]),[y,x]=v.exports.useState([]);v.exports.useEffect((()=>{(async()=>{const e=await d();e&&x(e.data)})()}),[]);const E=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"用户名",dataIndex:"userName",copyable:!0,ellipsis:!0,tip:"标题过长会自动收缩",formItemProps:{rules:[{required:!0,message:"此项为必填项"}]},render:(e,a)=>{var t,l;return g.createElement(I,{justify:"start",align:"middle",style:{flexFlow:"nowrap"}},(null==a?void 0:a.avatar)&&g.createElement(j,{style:{flex:"0 0 auto",marginRight:"5px"},src:null==(l=null==(t=a.avatar)?void 0:t[0])?void 0:l.url}),e)}},{title:"邮箱",dataIndex:"email"},{title:"手机号",dataIndex:"phone"},{title:"角色",dataIndex:"role",renderFormItem:()=>g.createElement(b,{allowClear:!0},null==y?void 0:y.map((e=>g.createElement(b.Option,{value:e.name,key:e._id},null==e?void 0:e.name))))},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime",sorter:!0,hideInSearch:!0},{title:"创建时间",dataIndex:"created_at",valueType:"dateTimeRange",hideInTable:!0,search:{transform:e=>({startTime:e[0],endTime:e[1]})}},{title:"操作",valueType:"option",width:180,render:(e,a,t,l)=>[g.createElement(T,{type:"link",key:"editable",onClick:()=>{k(a)}},"编辑"),g.createElement(S,{key:"del",placement:"topRight",title:"确定要删除吗?",onConfirm:()=>{var e,t;return q(null==a?void 0:a._id,null==(t=null==(e=null==a?void 0:a.avatar)?void 0:e[0])?void 0:t.uid)},okText:"确定",okType:"danger",cancelText:"取消"},g.createElement(T,{type:"link",danger:!0,key:"delete"},"删除"))]}],P=()=>{a(!0)},O=()=>{a(!1)},k=e=>{l(e),P()},q=async(e,a)=>{var t;const l=await(async(e,a)=>C(`/api/users/${e}/${a}`,{method:"DELETE"}))(e,a);l&&(null==(t=null==r?void 0:r.current)||t.reload(),w.success(l.message||"删除成功"))};return g.createElement(g.Fragment,null,g.createElement(p,{scroll:{x:!0},bordered:!0,request:async(e,a,t)=>{const l=await(async e=>C("/api/users",{method:"GET",params:e}))(i(i(i({},e),a),t));return l?{data:l.data,success:!0,total:l.total}:{data:void 0,success:!1,total:0}},columns:E,actionRef:r,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:{labelWidth:"auto"},form:{syncToUrl:(e,a)=>"get"===a?o(i({},e),{created_at:[e.startTime,e.endTime]}):e},pagination:{pageSize:5,pageSizeOptions:["5","10","20","30","50","100"]},dateFormatter:"string",headerTitle:"用户列表",toolBarRender:()=>[g.createElement(T,{key:"out",onClick:()=>{c(f,"角色管理")}},"导出数据"),g.createElement(T,{key:"button",icon:g.createElement(u,null),type:"primary",onClick:()=>{P(),l(void 0)}},"新建")]}),g.createElement(m,{onCloseDrawer:O,visibleDrawer:e,cItem:t,title:"新增用户",renderFormItemDom:()=>g.createElement(N,{setCaptcha:s,cItem:t}),onFinish:async e=>{var a,l,s,d;if(n===(null==e?void 0:e.captcha))if(t){const l=()=>{var a,t,l,r,n;return(null==(t=null==(a=null==e?void 0:e.avatar)?void 0:a.file)?void 0:t.preview)?null==(l=null==e?void 0:e.avatar)?void 0:l.file.preview:0===(null==(n=null==(r=null==e?void 0:e.avatar)?void 0:r.fileList)?void 0:n.length)?"":null==e?void 0:e.avatar},n=await(async(e,a)=>C(`/api/users/${e}`,{method:"PATCH",data:a}))(null==t?void 0:t._id,o(i({},e),{avatar:l()}));n&&(null==(a=null==r?void 0:r.current)||a.reload(),w.success(n.message||"更新成功"),O())}else{const a=await(async e=>C("/api/users",{method:"POST",data:e}))(o(i({},e),{avatar:null==(s=null==(l=null==e?void 0:e.avatar)?void 0:l.file)?void 0:s.preview}));a&&(null==(d=null==r?void 0:r.current)||d.reload(),w.success(a.message||"创建成功"),O())}else w.error("验证码错误")}}))};export{V as default};
