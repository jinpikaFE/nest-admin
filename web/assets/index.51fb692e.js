var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,s=(e,t)=>{for(var l in t||(t={}))r.call(t,l)&&n(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&n(e,l,t[l]);return e},i=(e,a)=>t(e,l(a));"undefined"!=typeof require&&require;import{r as d,R as c,t as u,b1 as m,Q as p,q as b,b2 as f}from"./vendor.6b110da5.js";import{u as v,c as y,d as E}from"./FromTreeMenu.a9395888.js";import{q as h}from"./global.b544051f.js";import{a as w}from"./constants.dbb12110.js";import{t as x}from"./untils.fef0d0c5.js";import{D as g,P as j,a as T}from"./Table.f76b0e48.js";import{b as k,a as C,S}from"./index.de14bc76.js";import"./index.10b1c10a.js";import"./index.2986d513.js";/* empty css              */import"./index.ade18ff5.js";const I=e=>{const{onCloseDrawer:t,visibleDrawer:l,refTable:a,cItem:r}=e,[o,n]=d.exports.useState([]),[b,f]=d.exports.useState("#fff"),E=d.exports.useRef();return d.exports.useEffect((()=>{if(l){(async()=>{const e=await h();if(e){let t=x(e.data,"_id","lastMenu",(e=>(e.title=e.name,e.value=e._id,(null==e?void 0:e.isLink)?(e.disabled=!0,e):e)));if(r){const e=(t,l)=>(t.forEach(((a,r)=>{(null==a?void 0:a.children)&&e(null==a?void 0:a.children,l),(null==a?void 0:a._id)===l&&t.splice(r,1)})),t);t=e(t,null==r?void 0:r._id)}n(t)}})()}}),[l,r]),d.exports.useEffect((()=>{var e,t;f("#fff"),l&&r&&(f(null==r?void 0:r.color),null==(e=null==E?void 0:E.current)||e.resetFields(),null==(t=null==E?void 0:E.current)||t.setFieldsValue(r))}),[l,r]),c.createElement(g,i(s({},{labelCol:{span:4},wrapperCol:{span:14}}),{title:"新建菜单",layout:"horizontal",visible:l,drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:t},onFinish:async e=>{var l,o;if(r){const o=await v(null==r?void 0:r._id,i(s({},e),{color:(null==(l=null==e?void 0:e.color)?void 0:l.hex)||(null==e?void 0:e.color)}));o&&(null==a||a.reload(),u.success(o.message||"更新成功"),t())}else{const l=await y(i(s({},e),{color:null==(o=null==e?void 0:e.color)?void 0:o.hex}));l&&(null==a||a.reload(),u.success(l.message||"创建成功"),t())}},initialValues:{status:1,isLink:0},formRef:E}),c.createElement(k,{width:"md",name:"name",label:"菜单名称",tooltip:"最长为 16 位",placeholder:"请输入菜单名称",rules:[{required:!0,message:"请输入菜单名称!"},{validator:(e,t,l)=>{t.length>16?l("菜单名过长，最长为 16 位"):l()}}]}),c.createElement(k,{width:"md",name:"path",label:"路由路径",placeholder:"路由路径，例‘/path/paths’,‘https://www.baidu.com/’",rules:[{required:!0,message:"请输入路由路径!"},{validator:(e,t,l)=>{const a=new RegExp("^(/[a-zA-Z]+)+$","g"),r=new RegExp("^https?://(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+.)+(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+)","g");a.test(t)||r.test(t)?l():l("请输入正确的路由")}}]}),c.createElement(C.Item,{label:"上级菜单",name:"lastMenu"},c.createElement(m,{allowClear:!0,style:{width:"328px"},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:o,placeholder:"请选择"})),c.createElement(k,{width:"md",name:"icon",label:"图标",placeholder:"请输入图标名",rules:[{required:!0,message:"请输入图标名!"},{validator:(e,t,l)=>{new RegExp("^[^一-龥]+$","g").test(t)?l():l("请输入正确的图标名")}}]}),c.createElement(C.Item,{name:"color",label:"菜单标签颜色",rules:[{required:!0,message:"请选择菜单标签颜色!"}]},c.createElement(S,{color:b,onChangeComplete:e=>{f(e.hex)}})),c.createElement(C.Item,{name:"status",label:"状态"},c.createElement(p.Group,{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]})),c.createElement(C.Item,{name:"isLink",label:"是否外链"},c.createElement(p.Group,{optionType:"button",buttonStyle:"solid",options:[{label:"否",value:0},{label:"是",value:1}]})))},R=()=>{const[e,t]=d.exports.useState(!1),[l,a]=d.exports.useState(),r=d.exports.useRef(),o=()=>{t(!0)},n=[{title:"菜单名称",dataIndex:"name",copyable:!0},{title:"图标",width:60,align:"center",dataIndex:"icon",render:e=>c.createElement(w,{type:e})},{title:"状态",dataIndex:"status",valueType:"select",valueEnum:{all:{text:"全部",status:"Default"},0:{text:"停用",status:"Error"},1:{text:"启用",status:"Success"}}},{title:"创建时间",dataIndex:"registerTime",valueType:"dateTime"},{title:"操作",valueType:"option",width:50,render:(e,t)=>[c.createElement(b,{type:"link",key:"editable",onClick:()=>{(e=>{a(e),o()})(t)}},"编辑"),c.createElement("span",{key:"del"},!(null==t?void 0:t.children)&&c.createElement(f,{placement:"topRight",title:"确定要删除吗?",onConfirm:()=>(async e=>{var t;const l=await E(e);l&&(null==(t=null==r?void 0:r.current)||t.reload(),u.success(l.message||"删除成功"))})(null==t?void 0:t._id),okText:"确定",okType:"danger",cancelText:"取消"},c.createElement(b,{type:"link",danger:!0,key:"delete"},"删除")))]}];return c.createElement(c.Fragment,null,c.createElement(j,{bordered:!0,actionRef:r,request:async()=>{const e=await h();if(e){return{data:x(e.data,"_id","lastMenu",(e=>e)),success:!0}}return{data:void 0,success:!1,total:0}},columns:n,editable:{type:"multiple"},columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"_id",search:!1,pagination:!1,dateFormatter:"string",headerTitle:"菜单列表",toolBarRender:()=>[c.createElement(b,{key:"button",icon:c.createElement(T,null),type:"primary",onClick:()=>{o(),a(void 0)}},"新建")]}),c.createElement(I,{onCloseDrawer:()=>{t(!1)},visibleDrawer:e,refTable:null==r?void 0:r.current,cItem:l}))},O=()=>c.createElement(R,null);export{O as default};
